<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style type="text/css">
        .hexagon {
            width: 170px;
            height: 170px;
            float: left;
            border: 1px dashed grey;
            border-radius: 85px;
            margin: 0px 5px 0px 5px;
            text-align: center;
            line-height: 170px;
        }
        .row {
            height: 172px;
        }
        .row3 {
            padding-left: 180px;
        }
        .row4 {
            padding-left: 90px;
        }
        #board {
            margin: 50px 25px 25px 25px;
            align-content: center;
        }
        .chances {
            position: relative;
            width: 70px;
            height: 50px;
            line-height: 50px;
            border-radius: 35px;
        }
        .top-left {
            top: -10px;
            left: -40px;
        }
        .top {
            top: -100px;
            left: 50px;
        }
        .top-right {
            top: -280px;
            left: 145px;
        }
        .bottom-right {
            top: -200px;
            left: 145px;
        }
        .bottom-left {
            top: -145px;
            left: -40px;
        }
        .bottom-left.last {
            top: -245px;
        }
        .bottom {
            top: -155px;
            left: 50px;
        }
        .bottom.last {
            top: -255px;
        }
        .number {
            position: relative;
            top: -100px;
            font-size: 40px;
        }
        #bottom-box {
            margin-top: 60px;
        }
        #box-top {
            width: 100%;
            line-height: 80px;
            font-size: 80px;
            text-align: center;
        }
        #instructions {
            width: 100%;
            line-height: 80px;
            font-size: 70px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="box-top">Settlers of Catan</div>
    <div id="board">
        <div class="row row3">
            <div class="hexagon ha">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
            </div>
            <div class="hexagon hb">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
            </div>
            <div class="hexagon hc">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
                <div class="chances top-right">.</div>

            </div>
        </div>
        <div class="row row4">
            <div class="hexagon hd">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>

            </div>
            <div class="hexagon he">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>

            </div>
            <div class="hexagon hf">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>

            </div>
            <div class="hexagon hg">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
                <div class="chances top-right">.</div>

            </div>

        </div>
        <div class="row">
            <div class="hexagon hh">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
                <div class="chances bottom-left">.</div>

            </div>
            <div class="hexagon hi">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>

            </div>
            <div class="hexagon hj">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
            </div>
            <div class="hexagon hk">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>

            </div>
            <div class="hexagon hl">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
                <div class="chances top-right">.</div>
                <div class="chances bottom-right">.</div>

            </div>

        </div>
        <div class="row row4">
            <div class="hexagon hm">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
                <div class="chances bottom-left">.</div>

            </div>
            <div class="hexagon hn">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>

                <div class="number">_</div>
            </div>
            <div class="hexagon ho">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>

                <div class="number">_</div>
            </div>
            <div class="hexagon hp">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>

                <div class="number">_</div>
                <div class="chances top-right">.</div>
                <div class="chances bottom-right">.</div>
            </div>

        </div>
        <div class="row row3">
            <div class="hexagon hq">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
                <div class="chances bottom-left">.</div>
                <div class="chances bottom">.</div>

            </div>
            <div class="hexagon hr">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
                <div class="chances bottom-left">.</div>
                <div class="chances bottom">.</div>

            </div>
            <div class="hexagon hs">
                <div class="chances top-left">.</div>
                <div class="chances top">.</div>
                <div class="number">_</div>
                <div class="chances top-right">.</div>
                <div class="chances bottom-right">.</div>
                <div class="chances bottom-left last">.</div>
                <div class="chances bottom last">.</div>

            </div>

        </div>
    </div>
    <div id="bottom-box">
        <div id="instructions">
            Tap on Desert
        </div>
    </div>
</body>
<script type="text/javascript">
    PROBS = {"2": 2.7777777777777777,
             "3": 5.555555555555555,
             "4": 8.333333333333334,
             "5": 11.11111111111111,
             "6": 13.88888888888889,
             "8": 13.88888888888889,
             "9": 11.11111111111111,
             "10": 8.333333333333334,
             "11": 5.555555555555555,
             "12": 2.7777777777777777,
             "0": 0.0}
    POSITIONS = {'x': '0'}

    NEIGHBOURHOOD = {
        "a": ['x', 'x', 'b', 'e', 'd', 'x'],
        "b": ['x', 'x', 'c', 'f', 'e', 'a'],
        "c": ['x', 'x', 'x', 'g', 'f', 'b'],
        "d": ['x', 'a', 'e', 'i', 'h', 'x'],
        "e": ['a', 'b', 'f', 'j', 'i', 'd'],
        "f": ['b', 'c', 'g', 'k', 'j', 'e'],
        "g": ['c', 'x', 'x', 'l', 'k', 'f'],
        "h": ['x', 'd', 'i', 'm', 'x', 'x'],
        "i": ['d', 'e', 'j', 'n', 'm', 'h'],
        "j": ['e', 'f', 'k', 'o', 'n', 'i'],
        "k": ['f', 'g', 'l', 'p', 'o', 'j'],
        "l": ['g', 'x', 'x', 'x', 'p', 'k'],
        "m": ['h', 'i', 'n', 'q', 'x', 'x'],
        "n": ['i', 'j', 'o', 'r', 'q', 'm'],
        "o": ['j', 'k', 'p', 's', 'r', 'n'],
        "p": ['k', 'l', 'x', 'x', 's', 'o'],
        "q": ['m', 'n', 'r', 'x', 'x', 'x'],
        "r": ['n', 'o', 's', 'x', 'x', 'q'],
        "s": ['o', 'p', 'x', 'x', 'x', 'r']
    }
    ALL_PROBS = []

    numbers = [12, 11, 11, 10, 10, 9, 9, 8, 8, 6, 6, 5, 5, 4, 4, 3, 3, 2, "X"]
    next_number = numbers.pop();
    instructions = document.querySelector("#instructions")

    function set_number(e) {
        e = e.target;
        if (next_number) {
            if (e.className && e.className.indexOf('number') != -1) {
                if (e.textContent != "_") {
                    return
                }
                e.textContent = next_number;
                next_number = numbers.pop();
                if (next_number) {
                    instructions.textContent = "Tap on " + next_number;
                } else {
                    set_chances();
                    instructions.textContent = "Set your settlements";
                }
            }            
        }
    }

    function set_chances_per_position(position) {
        neighbours = NEIGHBOURHOOD[position];
        center = document.querySelector(".h" + position)
        var tl = center.querySelector(".top-left")
        if (tl) {
            tl.textContent = calc_chances([position, neighbours[0], neighbours[5]]).toFixed(1) + "%"
        };
        var top = center.querySelector(".top")
        if (top) {
            top.textContent = calc_chances([position, neighbours[0], neighbours[1]]).toFixed(1) + "%"
        };
        var tr = center.querySelector(".top-right")
        if (tr) {
            tr.textContent = calc_chances([position, neighbours[1], neighbours[2]]).toFixed(1) + "%"
        };
        var bl = center.querySelector(".bottom-left")
        if (bl) {
            bl.textContent = calc_chances([position, neighbours[5], neighbours[4]]).toFixed(1) + "%"
        };
        var bottom = center.querySelector(".bottom")
        if (bottom) {
            bottom.textContent = calc_chances([position, neighbours[4], neighbours[3]]).toFixed(1) + "%"
        };
        var br = center.querySelector(".bottom-right")
        if (br) {
            br.textContent = calc_chances([position, neighbours[3], neighbours[2]]).toFixed(1) + "%"
        };

    }

    function calc_chances(positions) {
        var t = 0;
        for (var p in positions) {
            var c = PROBS[POSITIONS[positions[p]]];
            if (c) {
                t = t + c;
            }
        }
        ALL_PROBS.push(t);
        return t
    }
    function highlight_probs() {
        var max = Math.max.apply(Math, ALL_PROBS);
        var min = Math.min.apply(Math, ALL_PROBS);
        var objs = document.querySelectorAll(".chances");
        for (var i in objs) {
            i = objs[i];
            if (i.textContent) {
                var text = i.textContent.replace("%", "");
                var perc = parseFloat(text);
                if (perc + 3 >= max) {
                    var grad = "00";
                } else {
                    var grad = (perc - min) / (max - min);
                    grad = Math.ceil(255 - 150*grad).toString(16);                    
                }
                i.style.backgroundColor = "#FF" + grad + grad;                
            }
        }
    }

    function set_chances() {
        var ls = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's'];
        for (var p in ls) {
            var v = document.querySelector(".h" + ls[p]).querySelector(".number").textContent;
            POSITIONS[ls[p].toLowerCase()] = v
        }
        for (var p in ls) {
            set_chances_per_position(ls[p]);
        }
        highlight_probs();
    }
    // document.body.onclick = function(e) {
    //     set_number(e);
    // }
    document.body.ontouchstart = function(e) {
        set_number(e);
    }

</script>
</html>